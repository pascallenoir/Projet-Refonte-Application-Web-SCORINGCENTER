USE ScoringDB
GO

--BANQUES

IF EXISTS (SELECT * 
           FROM sys.foreign_keys 
           WHERE object_id = OBJECT_ID(N'dbo.ASSOCIATION_19_FK') 
             AND parent_object_id = OBJECT_ID(N'dbo.SCOR_AGENCE'))
BEGIN
	ALTER TABLE SCOR_AGENCE DROP CONSTRAINT ASSOCIATION_19_FK
END

IF EXISTS (SELECT * 
           FROM sys.foreign_keys 
           WHERE object_id = OBJECT_ID(N'dbo.ASSOCIATION_21_FK') 
             AND parent_object_id = OBJECT_ID(N'dbo.SCOR_PROFIL'))
BEGIN
	ALTER TABLE SCOR_PROFIL DROP CONSTRAINT ASSOCIATION_21_FK
END

IF EXISTS (SELECT * 
           FROM sys.foreign_keys 
           WHERE object_id = OBJECT_ID(N'dbo.ASSOCIATION_18_FK') 
             AND parent_object_id = OBJECT_ID(N'dbo.SCOR_CONTREPARTIE'))
BEGIN
	ALTER TABLE SCOR_CONTREPARTIE DROP CONSTRAINT ASSOCIATION_18_FK
END

ALTER TABLE SCOR_CONTREPARTIE ALTER COLUMN CODE_AGENCE T_CODE_10
GO


USE WEB_BILAN_DB
GO
--BANQUES

IF EXISTS (SELECT * 
           FROM sys.foreign_keys 
           WHERE object_id = OBJECT_ID(N'dbo.ASSOCIATION_19_FK') 
             AND parent_object_id = OBJECT_ID(N'dbo.SCOR_AGENCE'))
BEGIN
	ALTER TABLE SCOR_AGENCE DROP CONSTRAINT ASSOCIATION_19_FK
END

IF EXISTS (SELECT * 
           FROM sys.foreign_keys 
           WHERE object_id = OBJECT_ID(N'dbo.ASSOCIATION_21_FK') 
             AND parent_object_id = OBJECT_ID(N'dbo.SCOR_PROFIL'))
BEGIN
	ALTER TABLE SCOR_PROFIL DROP CONSTRAINT ASSOCIATION_21_FK
END

IF EXISTS (SELECT * 
           FROM sys.foreign_keys 
           WHERE object_id = OBJECT_ID(N'dbo.FK__SCOR_CONT__CODE___27AED5D5') 
             AND parent_object_id = OBJECT_ID(N'dbo.SCOR_CONTREPARTIE'))
BEGIN
	ALTER TABLE SCOR_CONTREPARTIE DROP CONSTRAINT FK__SCOR_CONT__CODE___27AED5D5
END

ALTER TABLE SCOR_CONTREPARTIE ALTER COLUMN CODE_AGENCE VARCHAR(10)

GO


USE ScoringDB
GO

IF EXISTS (SELECT * 
           FROM sys.foreign_keys 
           WHERE object_id = OBJECT_ID(N'dbo.FK__SCOR_DELE__CODE___5F34E040') 
             AND parent_object_id = OBJECT_ID(N'dbo.SCOR_DELEGUER'))
BEGIN
	ALTER TABLE SCOR_DELEGUER DROP CONSTRAINT FK__SCOR_DELE__CODE___5F34E040
END

IF EXISTS (SELECT * 
           FROM sys.foreign_keys 
           WHERE object_id = OBJECT_ID(N'dbo.ASSOCIATION_17_FK') 
             AND parent_object_id = OBJECT_ID(N'dbo.SCOR_UTILISATEUR'))
BEGIN
	ALTER TABLE SCOR_UTILISATEUR DROP CONSTRAINT ASSOCIATION_17_FK
END

IF EXISTS (SELECT * 
           FROM sys.foreign_keys 
           WHERE object_id = OBJECT_ID(N'dbo.FK_AGENCE_UTILISATEUR') 
             AND parent_object_id = OBJECT_ID(N'dbo.SCOR_UTILISATEUR'))
BEGIN
	ALTER TABLE SCOR_UTILISATEUR DROP CONSTRAINT FK_AGENCE_UTILISATEUR
END

ALTER TABLE SCOR_UTILISATEUR ALTER COLUMN CODE_AGENCE T_CODE_10

GO
USE WEB_BILAN_DB
GO
IF EXISTS (SELECT * 
           FROM sys.foreign_keys 
           WHERE object_id = OBJECT_ID(N'dbo.ASSOCIATION_17_FK') 
             AND parent_object_id = OBJECT_ID(N'dbo.SCOR_UTILISATEUR'))
BEGIN
	ALTER TABLE SCOR_UTILISATEUR DROP CONSTRAINT ASSOCIATION_17_FK
END

GO
USE ScoringDB
GO
UPDATE SCOR_CONTREPARTIE SET CODE_AGENCE = CONCAT('ML016', RIGHT(CODE_AGENCE, 5))
UPDATE SCOR_UTILISATEUR SET CODE_AGENCE = CONCAT('ML016', RIGHT(CODE_AGENCE, 5))

ALTER TABLE SCOR_AGENCE DROP CONSTRAINT PK_SCOR_AGENCE

ALTER TABLE SCOR_AGENCE ALTER COLUMN CODE_AGENCE T_CODE_10

TRUNCATE TABLE SCOR_AGENCE
TRUNCATE TABLE SCOR_BANQUE


GO
USE WEB_BILAN_DB
GO
UPDATE SCOR_UTILISATEUR SET CODE_AGENCE = CONCAT('ML016', RIGHT(CODE_AGENCE, 5))

ALTER TABLE SCOR_AGENCE DROP CONSTRAINT PK_SCOR_AGENCE

TRUNCATE TABLE SCOR_AGENCE
TRUNCATE TABLE SCOR_BANQUE
GO

USE ScoringDB
GO
DECLARE @REPERTOIRE_DONNEES VARCHAR(MAX) = 'C:\TEST\SCORING CSVs'
INSERT INTO SCOR_BANQUE
VALUES('BF179', 'BANQUE DE L''UNION BURKINA FASO', 'BDU-BF', 'BDU_BF.png', '236', 'ML016', @REPERTOIRE_DONNEES)

INSERT INTO SCOR_BANQUE
VALUES('TG221', 'BANQUE DE DEVELOPPEMENT DU TOGO', 'BDM-TG', 'BDM_TG.png', '280', 'ML016', @REPERTOIRE_DONNEES)

INSERT INTO SCOR_BANQUE
VALUES('SN221', 'BANQUE DE DEVELOPPEMENT DU SENEGAL', 'BDM-SN', 'BDM_SN.png', '248', 'ML016', @REPERTOIRE_DONNEES)

INSERT INTO SCOR_BANQUE
VALUES('GW128', 'BANQUE DE DEVELOPPEMENT DE LA GUINEE BISSEAU', 'BDM-GB', 'BDM_GB.png', '257', 'ML016', @REPERTOIRE_DONNEES)

INSERT INTO SCOR_BANQUE
VALUES('ML016', 'BANQUE DE DEVELOPPEMENT DU MALI', 'BDM-SA', 'BDM_SA.png', '232', 'ML016', @REPERTOIRE_DONNEES)

INSERT INTO SCOR_BANQUE
VALUES('A0180', 'BANQUE DE L''UNION COTE D''IVOIRE', 'BDU-CI', 'BDU-CI.png', '272', 'ML016', @REPERTOIRE_DONNEES)

UPDATE SCOR_PROFIL SET CODE_BANQUE = 'ML016'

ALTER TABLE SCOR_AGENCE ADD CONSTRAINT ASSOCIATION_19_FK FOREIGN KEY (CODE_BANQUE) REFERENCES SCOR_BANQUE (CODE_BANQUE) 

ALTER TABLE SCOR_PROFIL ADD CONSTRAINT ASSOCIATION_21_FK FOREIGN KEY (CODE_BANQUE) REFERENCES SCOR_BANQUE (CODE_BANQUE)

--AGENCES

INSERT INTO SCOR_AGENCE 
VALUES ('01001','BF179','Agence Principale / Kouame N''Kruma','01001'),
('01002','BF179','Agence Sankariaré / Hamdalaye / Tampouy','01002'),
('01003','BF179','Agence Pissy','01003'),
('01004','BF179','Agence Ouaga 2000','01004'),
('01005','BF179','Agence Zad / Saaba','01005'),
('01006','BF179','Agence Wayalghin','01006'),
('01007','BF179','Agence Cissin','01007'),
('01200','BF179','Agence Siège Central','01200'),
('02001','BF179','Agence Bobo marché','02001'),
--('02001','BF179','Agence Bobo Aéreport','02001'),
('02002','BF179','Agence Bobo Boulevard','02002'),
('03001','BF179','Agence koudougou / Ouahigouya','03001'),
('04001','BF179','Agence Dédougou','04001'),
('06001','BF179','Agence Tenkodogo','06001'),
('07001','BF179','Agence Banfora','07001'),
('10001','BF179','Agence Houndé','10001'),
('11001','BF179','Agence Kaya','11001'),
('01001','SN221','BDM SENEGAL','01001'),
('01001','TG221','BDM-TOGO','01001'),
('01001','GW128','AGENCE PRINCIPALE','01001'),
('01002','GW128','AGENCE BANDIM','01002'),
('01003','GW128','AGENCE GUIMETAL','01003'),
('02001','GW128','AGENCE GABU','02001'),
('03001','GW128','AGENCE BAFATA','03001'),
('04001','GW128','AGENCE CANCHUNGO','04001'),
('01001','ML016','AGENCE PRINCIPALE 2','01001'),
('01002','ML016','AGENCE DRAMANE DIAKITE','01002'),
('01201','ML016','AGENCE PRINCIPALE 1','01201'),
('01202','ML016','AGENCE BOUBACAR SIDIBE','01202'),
('01203','ML016','AGENCE SOGONIKO','01203'),
('01205','ML016','AGENCE KOROFINA','01205'),
('01206','ML016','AGENCE QUINZAMBOUGOU','01206'),
('01207','ML016','AGENCE BACO-DJICORONI','01207'),
('01208','ML016','AGENCE ACI 2000','01208'),
('01209','ML016','AGENCE LAFIABOUGOU','01209'),
('01210','ML016','AGENCE DJICORONI PARA','01210'),
('01211','ML016','AGENCE YIRIMADIO','01211'),
('01212','ML016','AGENCE BAGADADJI','01212'),
('01213','ML016','AGENCE NGOLONINA','01213'),
('01214','ML016','AGENCE AZAR CENTER BADALABOUGO','01214'),
('01215','ML016','AGENCE SEMA GEXCO BADALABOUGOU','01215'),
('01216','ML016','AGENCE TOROKOROBOUGOU','01216'),
('01217','ML016','AGENCE DE MISSIRA','01217'),
('01218','ML016','AGENCE DE SEBENIKORO','01218'),
('01219','ML016','AGENCE DE KALABAN COURA','01219'),
('01220','ML016','AGENCE SOTUBA','01220'),
('01221','ML016','AGENCE PME-PMI','01221'),
('01222','ML016','AGENCE DIBIDA','01222'),
('01223','ML016','AGENCE MAGNAMBOUGOU','01223'),
('01224','ML016','AGENCE KABALA','01224'),
('01225','ML016','AGENCE BOULKASSOUMBOUGOU','01225'),
('02006','ML016','AGENCE SIKASSO 2','02006'),
('02360','ML016','AGENCE SIKASSO 1','02360'),
('03540','ML016','AGENCE MOPTI','03540'),
('04003','ML016','AGENCE KAYES 2','04003'),
('04130','ML016','AGENCE KAYES 1','04130'),
('05364','ML016','AGENCE KOUTIALA','05364'),
('06004','ML016','AGENCE SEGOU 2','06004'),
('06450','ML016','AGENCE SEGOU 1','06450'),
('07620','ML016','AGENCE GAO','07620'),
('08728','ML016','AGENCE TOMBOUCTOU','08728'),
('09453','ML016','AGENCE NIONO','09453'),
('10451','ML016','AGENCE SAN','10451'),
('11005','ML016','AGENCE KOULIKORO','11005'),
('12305','ML016','AGENCE DE BOUGOUNI','12305'),
('15180','ML016','AGENCE KITA','15180'),
('17160','ML016','AGENCE NIORO DU SAHEL','17160'),
('18170','ML016','AGENCE YELIMANE','18170'),
('25000','ML016','AGENCE MANANTALI','25000'),
('27250','ML016','AGENCE KATI','27250'),
('28251','ML016','AGENCE BANAMBA','28251'),
('29252','ML016','AGENCE TOUBA','29252'),
('30190','ML016','AGENCE DIEMA','30190'),
('33253','ML016','AGENCE NARA','33253'),
('41370','ML016','AGENCE YANFOLILA','41370'),
('43140','ML016','AGENCE DE KENIEBA','43140'),
('20206','ML016','AGENCE DE FANA','20206'),
('44109','ML016','AGENCE DE MAHINA','44109'),
('01200','A0180','SIEGE','01200'),
('01001','A0180','AGENCE PRINCIPALE','01001'),
('01002','A0180','AGENCE ADJAME ','01002'),
('01003','A0180','AGENCE TREICHVILLE','01003'),
('01004','A0180','AGENCE PORT BOUET','01004'),
('01005','A0180','AGENCE KOUMASSI','01005'),
('02001','A0180','AGENCE BOUAKE','02001'),
('01006','A0180','AGENCE YOPOUGON ','01006'),
('08001','A0180','AGENCE DALOA','08001'),
('01007','A0180','AGENCE VALLON','01007'),
('01008','A0180','AGENCE MARCORY','01008'),
('01009','A0180','AGENCE CENTRE D''AFFAIRE','01009'),
('01010','A0180','AGENCE RIVIERA 4','01010'),
('01011','A0180','AGENCE ANGRE 8eme TRANCHE','01011'),
('06001','A0180','AGENCE KORHOGO','06001'),
('07001','A0180','AGENCE SAN PERDO','07001')

UPDATE SCOR_AGENCE
SET CODE_AGENCE = CONCAT(CODE_BANQUE, GUICHET_AGENCE)

ALTER TABLE SCOR_AGENCE
--ADD CONSTRAINT PK_SCOR_AGENCE PRIMARY KEY (CODE_AGENCE, CODE_BANQUE)
ADD CONSTRAINT PK_SCOR_AGENCE PRIMARY KEY (CODE_AGENCE)

ALTER TABLE SCOR_UTILISATEUR ADD CONSTRAINT FK_AGENCE_UTILISATEUR FOREIGN KEY (CODE_AGENCE) REFERENCES SCOR_AGENCE (CODE_AGENCE)

--CONTREPARTIE

IF EXISTS (SELECT * 
           FROM sys.foreign_keys 
           WHERE object_id = OBJECT_ID(N'dbo.FK__LOG_CONTR__ID_SC__3DBE1285') 
             AND parent_object_id = OBJECT_ID(N'dbo.LOG_CONTREPARTIE'))
BEGIN
	ALTER TABLE LOG_CONTREPARTIE DROP CONSTRAINT FK__LOG_CONTR__ID_SC__3DBE1285
END

IF EXISTS (SELECT * 
           FROM sys.foreign_keys 
           WHERE object_id = OBJECT_ID(N'dbo.POSSEDER_FK') 
             AND parent_object_id = OBJECT_ID(N'dbo.SCOR_DOSSIER'))
BEGIN
	ALTER TABLE SCOR_DOSSIER DROP CONSTRAINT POSSEDER_FK
END

IF EXISTS (SELECT * 
           FROM sys.foreign_keys 
           WHERE object_id = OBJECT_ID(N'dbo.FK__SCOR_HIST__ID_SC__74AE54BC') 
             AND parent_object_id = OBJECT_ID(N'dbo.SCOR_HISTORIQUE_NOTATION'))
BEGIN
	ALTER TABLE SCOR_HISTORIQUE_NOTATION DROP CONSTRAINT FK__SCOR_HIST__ID_SC__74AE54BC
END

DELETE FROM SCOR_CONTREPARTIE
WHERE CODE_AGENCE NOT IN (SELECT DISTINCT CODE_AGENCE FROM SCOR_AGENCE)

DELETE FROM LOG_CONTREPARTIE
WHERE ID_SCORING NOT IN (SELECT ID_SCORING FROM SCOR_CONTREPARTIE)

--DOSSIER DROP CONSTRAINTS

IF EXISTS (SELECT * 
           FROM sys.foreign_keys 
           WHERE object_id = OBJECT_ID(N'dbo.FK__SCOR_DATE__ID_DO__1590F0F1') 
             AND parent_object_id = OBJECT_ID(N'dbo.SCOR_DATE_VALIDATION_ENCOURS'))
BEGIN
	ALTER TABLE SCOR_DATE_VALIDATION_ENCOURS DROP CONSTRAINT FK__SCOR_DATE__ID_DO__1590F0F1
END

IF EXISTS (SELECT * 
           FROM sys.foreign_keys 
           WHERE object_id = OBJECT_ID(N'dbo.FK__SCOR_DOSS__ID_DO__597C06EA') 
             AND parent_object_id = OBJECT_ID(N'dbo.SCOR_DOSSIER_SEUIL_CREDIT'))
BEGIN
	ALTER TABLE SCOR_DOSSIER_SEUIL_CREDIT DROP CONSTRAINT FK__SCOR_DOSS__ID_DO__597C06EA
END

IF EXISTS (SELECT * 
           FROM sys.foreign_keys 
           WHERE object_id = OBJECT_ID(N'dbo.CONCERNER_FK') 
             AND parent_object_id = OBJECT_ID(N'dbo.SCOR_PROPOSITION'))
BEGIN
	ALTER TABLE SCOR_PROPOSITION DROP CONSTRAINT CONCERNER_FK
END

IF EXISTS (SELECT * 
           FROM sys.foreign_keys 
           WHERE object_id = OBJECT_ID(N'dbo.FK__SCOR_VALI__ID_DO__79E80B25') 
             AND parent_object_id = OBJECT_ID(N'dbo.SCOR_VALIDATION'))
BEGIN
	ALTER TABLE SCOR_VALIDATION DROP CONSTRAINT FK__SCOR_VALI__ID_DO__79E80B25
END

DELETE FROM SCOR_DOSSIER
WHERE ID_SCORING NOT IN (SELECT ID_SCORING FROM SCOR_CONTREPARTIE)

DELETE FROM SCOR_HISTORIQUE_NOTATION
WHERE ID_SCORING NOT IN (SELECT ID_SCORING FROM SCOR_CONTREPARTIE)

--CONTREPARTIE RESTORE FOREIGN KEY CONSTRAINTS

ALTER TABLE LOG_CONTREPARTIE
ADD CONSTRAINT FK__LOG_CONTR__ID_SC__3DBE1285 FOREIGN KEY (ID_SCORING) REFERENCES SCOR_CONTREPARTIE (ID_SCORING)

ALTER TABLE SCOR_DOSSIER
ADD CONSTRAINT POSSEDER_FK FOREIGN KEY (ID_SCORING) REFERENCES SCOR_CONTREPARTIE (ID_SCORING)

ALTER TABLE SCOR_HISTORIQUE_NOTATION
ADD CONSTRAINT FK__SCOR_HIST__ID_SC__74AE54BC FOREIGN KEY (ID_SCORING) REFERENCES SCOR_CONTREPARTIE (ID_SCORING)

--DOSSIER DELETE IN DEPENDING TABLES

DELETE FROM SCOR_DATE_VALIDATION_ENCOURS
WHERE ID_DOSSIER NOT IN (SELECT ID_DOSSIER FROM SCOR_DOSSIER)

DELETE FROM SCOR_DOSSIER_SEUIL_CREDIT
WHERE ID_DOSSIER NOT IN (SELECT ID_DOSSIER FROM SCOR_DOSSIER)

DELETE FROM SCOR_PROPOSITION
WHERE ID_DOSSIER NOT IN (SELECT ID_DOSSIER FROM SCOR_DOSSIER)

DELETE FROM SCOR_VALIDATION
WHERE ID_DOSSIER NOT IN (SELECT ID_DOSSIER FROM SCOR_DOSSIER)

--DOSSIER RESTORE FOREIGN KEY CONSTRAINTS

ALTER TABLE SCOR_DATE_VALIDATION_ENCOURS
ADD CONSTRAINT FK__SCOR_DATE__ID_DO__1590F0F1 FOREIGN KEY (ID_DOSSIER) REFERENCES SCOR_DOSSIER (ID_DOSSIER)

ALTER TABLE SCOR_DOSSIER_SEUIL_CREDIT
ADD CONSTRAINT FK__SCOR_DOSS__ID_DO__597C06EA FOREIGN KEY (ID_DOSSIER) REFERENCES SCOR_DOSSIER (ID_DOSSIER)

ALTER TABLE SCOR_PROPOSITION
ADD CONSTRAINT CONCERNER_FK FOREIGN KEY (ID_DOSSIER) REFERENCES SCOR_DOSSIER (ID_DOSSIER)

ALTER TABLE SCOR_VALIDATION
ADD CONSTRAINT FK__SCOR_VALI__ID_DO__79E80B25 FOREIGN KEY (ID_DOSSIER) REFERENCES SCOR_DOSSIER (ID_DOSSIER)

ALTER TABLE SCOR_UTILISATEUR ADD CONSTRAINT ASSOCIATION_17_FK FOREIGN KEY (CODE_AGENCE) REFERENCES SCOR_AGENCE (CODE_AGENCE)

GO


USE WEB_BILAN_DB
GO
UPDATE SCOR_CONTREPARTIE SET CODE_AGENCE = CONCAT('ML016', RIGHT(CODE_AGENCE, 5))

DECLARE @REPERTOIRE_DONNEES VARCHAR(MAX) = 'C:\TEST\SCORING CSVs'
INSERT INTO SCOR_BANQUE
VALUES('BF179', 'BANQUE DE L''UNION BURKINA FASO', 'BDU-BF', 'BDU_BF.png', '236', 'ML016', @REPERTOIRE_DONNEES)

INSERT INTO SCOR_BANQUE
VALUES('TG221', 'BANQUE DE DEVELOPPEMENT DU TOGO', 'BDM-TG', 'BDM_TG.png', '280', 'ML016', @REPERTOIRE_DONNEES)

INSERT INTO SCOR_BANQUE
VALUES('SN221', 'BANQUE DE DEVELOPPEMENT DU SENEGAL', 'BDM-SN', 'BDM_SN.png', '248', 'ML016', @REPERTOIRE_DONNEES)

INSERT INTO SCOR_BANQUE
VALUES('GW128', 'BANQUE DE DEVELOPPEMENT DE LA GUINEE BISSEAU', 'BDM-GB', 'BDM_GB.png', '257', 'ML016', @REPERTOIRE_DONNEES)

INSERT INTO SCOR_BANQUE
VALUES('ML016', 'BANQUE DE DEVELOPPEMENT DU MALI', 'BDM-SA', 'BDM_SA.png', '232', 'ML016', @REPERTOIRE_DONNEES)

INSERT INTO SCOR_BANQUE
VALUES('A0180', 'BANQUE DE L''UNION COTE D''IVOIRE', 'BDU-CI', 'BDU-CI.png', '272', 'ML016', @REPERTOIRE_DONNEES)

UPDATE SCOR_PROFIL SET CODE_BANQUE = 'ML016'
UPDATE SCOR_CONTREPARTIE SET CODE_BANQUE = 'ML016'

ALTER TABLE SCOR_AGENCE ADD CONSTRAINT ASSOCIATION_19_FK FOREIGN KEY (CODE_BANQUE) REFERENCES SCOR_BANQUE (CODE_BANQUE) 

ALTER TABLE SCOR_PROFIL ADD CONSTRAINT ASSOCIATION_21_FK FOREIGN KEY (CODE_BANQUE) REFERENCES SCOR_BANQUE (CODE_BANQUE)

ALTER TABLE SCOR_CONTREPARTIE ADD CONSTRAINT FK__SCOR_CONT__CODE___27AED5D5 FOREIGN KEY (CODE_BANQUE) REFERENCES SCOR_BANQUE (CODE_BANQUE)

--AGENCES

INSERT INTO SCOR_AGENCE
VALUES ('01001','BF179','Agence Principale / Kouame N''Kruma','01001'),
('01002','BF179','Agence Sankariaré / Hamdalaye / Tampouy','01002'),
('01003','BF179','Agence Pissy','01003'),
('01004','BF179','Agence Ouaga 2000','01004'),
('01005','BF179','Agence Zad / Saaba','01005'),
('01006','BF179','Agence Wayalghin','01006'),
('01007','BF179','Agence Cissin','01007'),
('01200','BF179','Agence Siège Central','01200'),
('02001','BF179','Agence Bobo marché','02001'),
--('02001','BF179','Agence Bobo Aéreport','02001'),
('02002','BF179','Agence Bobo Boulevard','02002'),
('03001','BF179','Agence koudougou / Ouahigouya','03001'),
('04001','BF179','Agence Dédougou','04001'),
('06001','BF179','Agence Tenkodogo','06001'),
('07001','BF179','Agence Banfora','07001'),
('10001','BF179','Agence Houndé','10001'),
('11001','BF179','Agence Kaya','11001'),
('01001','SN221','BDM SENEGAL','01001'),
('01001','TG221','BDM-TOGO','01001'),
('01001','GW128','AGENCE PRINCIPALE','01001'),
('01002','GW128','AGENCE BANDIM','01002'),
('01003','GW128','AGENCE GUIMETAL','01003'),
('02001','GW128','AGENCE GABU','02001'),
('03001','GW128','AGENCE BAFATA','03001'),
('04001','GW128','AGENCE CANCHUNGO','04001'),
('01001','ML016','AGENCE PRINCIPALE 2','01001'),
('01002','ML016','AGENCE DRAMANE DIAKITE','01002'),
('01201','ML016','AGENCE PRINCIPALE 1','01201'),
('01202','ML016','AGENCE BOUBACAR SIDIBE','01202'),
('01203','ML016','AGENCE SOGONIKO','01203'),
('01205','ML016','AGENCE KOROFINA','01205'),
('01206','ML016','AGENCE QUINZAMBOUGOU','01206'),
('01207','ML016','AGENCE BACO-DJICORONI','01207'),
('01208','ML016','AGENCE ACI 2000','01208'),
('01209','ML016','AGENCE LAFIABOUGOU','01209'),
('01210','ML016','AGENCE DJICORONI PARA','01210'),
('01211','ML016','AGENCE YIRIMADIO','01211'),
('01212','ML016','AGENCE BAGADADJI','01212'),
('01213','ML016','AGENCE NGOLONINA','01213'),
('01214','ML016','AGENCE AZAR CENTER BADALABOUGO','01214'),
('01215','ML016','AGENCE SEMA GEXCO BADALABOUGOU','01215'),
('01216','ML016','AGENCE TOROKOROBOUGOU','01216'),
('01217','ML016','AGENCE DE MISSIRA','01217'),
('01218','ML016','AGENCE DE SEBENIKORO','01218'),
('01219','ML016','AGENCE DE KALABAN COURA','01219'),
('01220','ML016','AGENCE SOTUBA','01220'),
('01221','ML016','AGENCE PME-PMI','01221'),
('01222','ML016','AGENCE DIBIDA','01222'),
('01223','ML016','AGENCE MAGNAMBOUGOU','01223'),
('01224','ML016','AGENCE KABALA','01224'),
('01225','ML016','AGENCE BOULKASSOUMBOUGOU','01225'),
('02006','ML016','AGENCE SIKASSO 2','02006'),
('02360','ML016','AGENCE SIKASSO 1','02360'),
('03540','ML016','AGENCE MOPTI','03540'),
('04003','ML016','AGENCE KAYES 2','04003'),
('04130','ML016','AGENCE KAYES 1','04130'),
('05364','ML016','AGENCE KOUTIALA','05364'),
('06004','ML016','AGENCE SEGOU 2','06004'),
('06450','ML016','AGENCE SEGOU 1','06450'),
('07620','ML016','AGENCE GAO','07620'),
('08728','ML016','AGENCE TOMBOUCTOU','08728'),
('09453','ML016','AGENCE NIONO','09453'),
('10451','ML016','AGENCE SAN','10451'),
('11005','ML016','AGENCE KOULIKORO','11005'),
('12305','ML016','AGENCE DE BOUGOUNI','12305'),
('15180','ML016','AGENCE KITA','15180'),
('17160','ML016','AGENCE NIORO DU SAHEL','17160'),
('18170','ML016','AGENCE YELIMANE','18170'),
('25000','ML016','AGENCE MANANTALI','25000'),
('27250','ML016','AGENCE KATI','27250'),
('28251','ML016','AGENCE BANAMBA','28251'),
('29252','ML016','AGENCE TOUBA','29252'),
('30190','ML016','AGENCE DIEMA','30190'),
('33253','ML016','AGENCE NARA','33253'),
('41370','ML016','AGENCE YANFOLILA','41370'),
('43140','ML016','AGENCE DE KENIEBA','43140'),
('20206','ML016','AGENCE DE FANA','20206'),
('44109','ML016','AGENCE DE MAHINA','44109'),
('01200','A0180','SIEGE','01200'),
('01001','A0180','AGENCE PRINCIPALE','01001'),
('01002','A0180','AGENCE ADJAME ','01002'),
('01003','A0180','AGENCE TREICHVILLE','01003'),
('01004','A0180','AGENCE PORT BOUET','01004'),
('01005','A0180','AGENCE KOUMASSI','01005'),
('02001','A0180','AGENCE BOUAKE','02001'),
('01006','A0180','AGENCE YOPOUGON ','01006'),
('08001','A0180','AGENCE DALOA','08001'),
('01007','A0180','AGENCE VALLON','01007'),
('01008','A0180','AGENCE MARCORY','01008'),
('01009','A0180','AGENCE CENTRE D''AFFAIRE','01009'),
('01010','A0180','AGENCE RIVIERA 4','01010'),
('01011','A0180','AGENCE ANGRE 8eme TRANCHE','01011'),
('06001','A0180','AGENCE KORHOGO','06001'),
('07001','A0180','AGENCE SAN PERDO','07001')

UPDATE SCOR_AGENCE
SET CODE_AGENCE = CONCAT(CODE_BANQUE, GUICHET_AGENCE)

ALTER TABLE SCOR_AGENCE 
--ADD CONSTRAINT PK_SCOR_AGENCE PRIMARY KEY (CODE_AGENCE, CODE_BANQUE)
ADD CONSTRAINT PK_SCOR_AGENCE PRIMARY KEY (CODE_AGENCE)

ALTER TABLE SCOR_UTILISATEUR ADD CONSTRAINT ASSOCIATION_17_FK FOREIGN KEY (CODE_AGENCE) REFERENCES SCOR_AGENCE (CODE_AGENCE)